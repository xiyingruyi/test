#!name=布丁扫描高级功能解锁 (20G)
#!desc=解锁布丁扫描的高级会员状态和20G云空间

[mitm]
hostname = www.budingscan.com

[rewrite_local]

# ----------------------------------------------------
# 规则：匹配获取用户配置的API
# ----------------------------------------------------
^https:\/\/www\.budingscan\.com\/server\/get_user_config url script-response-body buding_scan_premium.js

# ----------------------------------------------------
# 脚本内容：buding_scan_premium.js (使用base64编码嵌入脚本)
# ----------------------------------------------------
# 注意：Quantumult X 暂时不支持在 [rewrite_local] 规则后直接嵌入长脚本。
# 我们使用标准的 QX 远程脚本格式，将脚本代码嵌入到配置中。
# 此处为了简洁和兼容性，推荐使用 QX 的 [script] 部分来定义本地脚本。

[script]
buding_scan_premium.js = type=http-response,pattern=^https:\/\/www\.budingscan\.com\/server\/get_user_config,requires-body=1,script-path=https://raw.githubusercontent.com/YourRepo/YourFile/master/buding_scan_premium.js,script-update-interval=0

# --- 以下是脚本的实际内容，您可以将其替换上面的远程链接，实现文件合并 ---
# 如果您想将脚本代码直接合并到配置文件中，请使用以下格式：
# 注意：这种内嵌格式通常放在配置文件的最底部，或者独立文件导入

buding_scan_premium_embedded.js = type=http-response,pattern=^https:\/\/www\.budingscan\.com\/server\/get_user_config,requires-body=1,max-size=0,script-body=
/*
  脚本作用：布丁扫描 - 尝试模拟高级用户/会员状态解锁功能
  目标域名：www.budingscan.com
*/

let obj = JSON.parse($response.body);

if (obj.result && obj.code === 0) {
    let result = obj.result;

    // 设置一个极远的过期时间戳 (2099-12-31 23:59:59 的毫秒时间戳)
    const maxTimestamp = 4102444799000; 

    // 1. 设置高级会员相关状态
    result.end_time = maxTimestamp;           // 永久会员过期时间
    result.renewal_status = 1;                // 续费状态设为 1 (已订阅)
    result.subscribe_plan_name = "Premium User (Lifetime)"; // 会员计划名称
    result.subscribe_plan_validity = 1;       // 订阅计划设为 1 (有效)
    result.user_type = 1;                     // 用户类型设为 1 (会员)

    // 2. 解锁存储空间，设置为 20 GB 对应的字节数
    // 20 GB = 21474836480 字节
    result.vip_storage = 21474836480; 
    
    // 3. 可选：清除付费相关字段
    result.next_pay_price = null;
    result.next_pay_time = null;
    result.subscribe_pay_type = 1; 

    // 保证 code 还是成功
    obj.code = 0; 
}

$done({body: JSON.stringify(obj)});
